<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Dashboard - QR Inventory System</title>
    <link rel="stylesheet" href="dashboard-modern.css">
    <link rel="stylesheet" href="transaction-history.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Additional styles for existing functionality */
        .section-content {
            background: var(--white);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .qr-result {
            margin-top: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            text-align: center;
            border: 2px solid var(--success);
        }
        
        #qr-display img {
            max-width: 100%;
            width: 280px;
            height: auto;
            border: 3px solid var(--dark);
            padding: 15px;
            background: var(--white);
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        #reader {
            border: 3px solid var(--primary);
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
            max-width: 400px;
            height: 400px;
            margin: 0 auto;
            background: var(--dark);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .scan-options {
            display: flex;
            gap: 1rem;
            margin: 2rem 0;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 100px;
            cursor: pointer;
            font-size: 0.925rem;
            font-weight: 700;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            min-width: 150px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--white);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
            color: var(--white);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: var(--white);
        }
        
        .btn-secondary {
            background: var(--white);
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.925rem;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: 10px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-qrcode"></i>
                    <span>QR Inventory</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" onclick="showSection('dashboard', event)">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('create-product', event)">
                    <i class="fas fa-plus-circle"></i>
                    <span>Create Product</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('scan-qr', event)">
                    <i class="fas fa-qrcode"></i>
                    <span>Scan QR</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('inventory', event)">
                    <i class="fas fa-boxes"></i>
                    <span>Inventory</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('transactions', event)">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('tailor-management', event)">
                    <i class="fas fa-user-tie"></i>
                    <span>Tailor Management</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('reports', event)">
                    <i class="fas fa-chart-line"></i>
                    <span>Reports</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <a href="admin.html" class="nav-item" id="admin-link" style="display: none;">
                    <i class="fas fa-user-shield"></i>
                    <span>Admin Portal</span>
                </a>
                <a href="login.html" class="nav-item">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="topbar">
                <div class="topbar-left">
                    <button class="menu-toggle" id="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">Dashboard</h1>
                </div>
                
                <div class="topbar-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search inventory..." id="global-search">
                    </div>
                    
                    <button class="topbar-btn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </button>
                    
                    <div class="user-menu">
                        <img src="https://ui-avatars.com/api/?name=Employee&background=6366f1&color=fff" alt="User" class="user-avatar">
                        <span class="user-name" id="user-info">Employee</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </header>
            
            <!-- Dashboard Content -->
            <div class="dashboard-content">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section active">
                    <!-- Quick Stats -->
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-label">Total Items</span>
                                <span class="stat-value" id="total-items">0</span>
                                <span class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i> Updated
                                </span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <i class="fas fa-tags"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-label">Product Types</span>
                                <span class="stat-value" id="product-types">0</span>
                                <span class="stat-change">
                                    <i class="fas fa-minus"></i> Stable
                                </span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <i class="fas fa-exchange-alt"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-label">Recent Transactions</span>
                                <span class="stat-value" id="recent-transactions">0</span>
                                <span class="stat-change positive">
                                    <i class="fas fa-arrow-up"></i> Active
                                </span>
                            </div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="stat-details">
                                <span class="stat-label">Low Stock Items</span>
                                <span class="stat-value" id="low-stock">0</span>
                                <span class="stat-change negative">
                                    <i class="fas fa-arrow-down"></i> Alert
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="charts-row">
                        <div class="chart-card">
                            <div class="card-header">
                                <h3>Inventory Overview</h3>
                                <div class="card-actions">
                                    <select class="period-select">
                                        <option>This Week</option>
                                        <option>This Month</option>
                                        <option>This Year</option>
                                    </select>
                                </div>
                            </div>
                            <div class="card-body">
                                <canvas id="salesChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="chart-card small">
                            <div class="card-header">
                                <h3>Stock Distribution</h3>
                            </div>
                            <div class="card-body">
                                <canvas id="stockChart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Summary Table -->
                    <div class="table-card">
                        <div class="card-header">
                            <h3>Inventory Summary</h3>
                            <div class="card-actions">
                                <button class="btn-text" onclick="showSection('inventory', event)">View All</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="inventory-summary"></div>
                        </div>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <h3>Quick Actions</h3>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="showSection('create-product', event)">
                                <i class="fas fa-plus"></i>
                                <span>Add Product</span>
                            </button>
                            <button class="action-btn" onclick="showSection('scan-qr', event)">
                                <i class="fas fa-qrcode"></i>
                                <span>Scan QR</span>
                            </button>
                            <button class="action-btn" onclick="exportReport()">
                                <i class="fas fa-file-export"></i>
                                <span>Export Report</span>
                            </button>
                            <button class="action-btn" onclick="syncData()">
                                <i class="fas fa-sync"></i>
                                <span>Sync Data</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Create Product Section -->
                <div id="create-product" class="section">
                    <iframe src="product-simple.html" style="width: 100%; height: calc(100vh - 70px); border: none;"></iframe>
                </div>
                
                <!-- Scan QR Section -->
                <div id="scan-qr" class="section">
                    <div class="section-content">
                        <h2>Scan QR Code</h2>
                        
                        <div class="scan-options">
                            <button onclick="startScanner()" class="btn btn-primary">Start Camera Scanner</button>
                            <button onclick="showManualEntry()" class="btn btn-secondary">Manual Entry</button>
                        </div>
                        
                        <div id="scanner-container" style="display: none;">
                            <div class="scanner-wrapper">
                                <p id="camera-info" style="text-align: center; color: #666; margin-bottom: 1rem;">
                                    Requesting camera permission...
                                </p>
                                <div class="reader-container">
                                    <div id="reader"></div>
                                </div>
                                <div id="camera-loading" style="text-align: center; padding: 2rem; display: none;">
                                    <div class="loading">
                                        <div class="spinner"></div>
                                        <p style="margin-top: 1rem;">Initializing camera...</p>
                                    </div>
                                </div>
                                <button onclick="stopScanner()" class="btn btn-danger" style="margin-top: 1rem; display: block; margin-left: auto; margin-right: auto;">Stop Scanner</button>
                            </div>
                        </div>
                        
                        <div id="manual-entry" style="display: none;">
                            <div class="form-group">
                                <label for="manual-product-id">Enter Product ID</label>
                                <input type="text" id="manual-product-id" placeholder="e.g., SHI-M-ABC123">
                            </div>
                        </div>
                        
                        <div id="scan-result" class="scan-result" style="display: none;">
                            <div id="product-details"></div>
                            
                            <h3>Update Inventory</h3>
                            <form id="inventory-action-form" class="form">
                                <div class="form-group">
                                    <label for="action">Action</label>
                                    <select id="action" required>
                                        <option value="">Select Action</option>
                                        <option value="IN">Add Items (Stock In)</option>
                                        <option value="OUT">Remove Items (Stock Out)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="quantity">Quantity</label>
                                    <input type="number" id="quantity" value="1" min="1" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="performed-by">Performed By</label>
                                    <input type="text" id="performed-by" placeholder="Enter your name">
                                </div>
                                
                                <div class="form-group">
                                    <label for="location">Location (Optional)</label>
                                    <input type="text" id="location" placeholder="e.g., Warehouse A">
                                </div>
                                
                                <div class="form-group">
                                    <label for="notes">Notes (Optional)</label>
                                    <textarea id="notes" rows="2"></textarea>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Update Inventory</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Inventory Section -->
                <div id="inventory" class="section">
                    <iframe src="inventory-advanced.html" style="width: 100%; height: calc(100vh - 70px); border: none;"></iframe>
                </div>
                
                <!-- Transactions Section -->
                <div id="transactions" class="section">
                    <div class="transaction-container">
                        <!-- Simple Header -->
                        <div class="transaction-header-simple">
                            <div class="header-left">
                                <h2>Transaction History</h2>
                                <span class="record-count" id="transaction-count">0 Records</span>
                            </div>
                        </div>
                        
                        <!-- Simple Filter Bar -->
                        <div class="transaction-filter-bar">
                            <!-- Search -->
                            <div class="search-box-trans">
                                <i class="fas fa-search"></i>
                                <input type="text" id="search-transactions" placeholder="Search transactions...">
                            </div>
                            
                            <!-- Type Filter -->
                            <div class="filter-inline">
                                <label class="mobile-label">Type:</label>
                                <select id="transaction-type-filter" class="inline-select" onchange="filterByTypeSelect(this.value)">
                                    <option value="all">All Types</option>
                                    <option value="in">Stock In</option>
                                    <option value="out">Stock Out</option>
                                    <option value="update">Updated</option>
                                    <option value="remove">Removed</option>
                                </select>
                            </div>
                            
                            <!-- Spacer -->
                            <div class="nav-spacer"></div>
                            
                            <!-- Show Entries -->
                            <div class="entries-inline">
                                <label>Show</label>
                                <select id="trans-per-page" class="inline-select" onchange="updateTransactionDisplay()">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <label class="entries-label">entries</label>
                            </div>
                        </div>
                        
                        <!-- Transaction Table -->
                        <div class="trans-table-wrapper">
                            <table class="trans-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Date & Time</th>
                                        <th>Product</th>
                                        <th>Status</th>
                                        <th>Quantity</th>
                                        <th>Stock Level</th>
                                        <th>User</th>
                                    </tr>
                                </thead>
                                <tbody id="trans-tbody">
                                    <!-- Sample rows for demonstration -->
                                    <tr>
                                        <td>TRX-000001</td>
                                        <td>
                                            <div class="time-info">
                                                <span class="date">Dec 26, 2024</span>
                                                <span class="time">10:30 AM</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="product-info">
                                                <span class="prod-name">Blue Cotton Shirt</span>
                                                <span class="prod-sku">BCS-M-001</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="status-badge stock-in">
                                                <i class="fas fa-arrow-down"></i> Stock In
                                            </span>
                                        </td>
                                        <td class="qty-change positive">+50</td>
                                        <td>
                                            <span class="stock-before">100</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span class="stock-after">150</span>
                                        </td>
                                        <td>John Doe</td>
                                    </tr>
                                    <tr>
                                        <td>TRX-000002</td>
                                        <td>
                                            <div class="time-info">
                                                <span class="date">Dec 26, 2024</span>
                                                <span class="time">11:15 AM</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="product-info">
                                                <span class="prod-name">Black Denim Jeans</span>
                                                <span class="prod-sku">BDJ-L-002</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="status-badge stock-out">
                                                <i class="fas fa-arrow-up"></i> Stock Out
                                            </span>
                                        </td>
                                        <td class="qty-change negative">-20</td>
                                        <td>
                                            <span class="stock-before">80</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span class="stock-after">60</span>
                                        </td>
                                        <td>Jane Smith</td>
                                    </tr>
                                    <tr>
                                        <td>TRX-000003</td>
                                        <td>
                                            <div class="time-info">
                                                <span class="date">Dec 26, 2024</span>
                                                <span class="time">02:30 PM</span>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="product-info">
                                                <span class="prod-name">Red Polo Shirt</span>
                                                <span class="prod-sku">RPS-S-003</span>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="status-badge updated">
                                                <i class="fas fa-edit"></i> Updated
                                            </span>
                                        </td>
                                        <td class="qty-change neutral">0</td>
                                        <td>
                                            <span class="stock-before">45</span>
                                            <i class="fas fa-arrow-right"></i>
                                            <span class="stock-after">45</span>
                                        </td>
                                        <td>Mike Johnson</td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- Empty State -->
                            <div class="trans-empty" id="trans-empty" style="display: none;">
                                <i class="fas fa-inbox"></i>
                                <h3>No Transactions Found</h3>
                                <p>Start scanning QR codes to track inventory movements</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tailor Management Section -->
                <div id="tailor-management" class="section">
                    <div class="section-content">
                        <h2>Tailor & Garment Management</h2>
                        
                        <!-- Dashboard Stats -->
                        <div id="tailor-dashboard-stats"></div>
                        
                        <!-- Tab Navigation -->
                        <div class="tab-nav">
                            <button class="tab-btn active" onclick="showTailorTab('tailors-tab', event)">Tailors</button>
                            <button class="tab-btn" onclick="showTailorTab('assignments-tab', event)">Work Assignments</button>
                            <button class="tab-btn" onclick="showTailorTab('fabrics-tab', event)">Fabrics</button>
                        </div>
                        
                        <!-- Tailors Tab -->
                        <div id="tailors-tab" class="tab-content active">
                            <h3>Register New Tailor</h3>
                            <form id="tailor-form" class="form">
                                <div class="form-group">
                                    <label for="tailor-name">Tailor Name</label>
                                    <input type="text" id="tailor-name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tailor-specialization">Specialization</label>
                                    <input type="text" id="tailor-specialization" placeholder="e.g., Shirts, Pants, Alterations">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tailor-contact">Contact Number</label>
                                    <input type="tel" id="tailor-contact">
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Register Tailor</button>
                            </form>
                            
                            <h3>Registered Tailors</h3>
                            <div class="filter-bar">
                                <input type="text" id="search-tailors" class="search-input" placeholder="Search tailors...">
                            </div>
                            <div id="tailors-list" class="table-container"></div>
                        </div>
                        
                        <!-- Assignments Tab -->
                        <div id="assignments-tab" class="tab-content">
                            <h3>Create Work Assignment</h3>
                            <form id="assignment-form" class="form">
                                <div class="form-group">
                                    <label for="assignment-tailor">Select Tailor</label>
                                    <select id="assignment-tailor" required>
                                        <option value="">Select Tailor</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="assignment-product">Product ID (Optional)</label>
                                    <input type="text" id="assignment-product" placeholder="Link to existing product">
                                </div>
                                
                                <div class="form-group">
                                    <label for="garment-type">Garment Type</label>
                                    <select id="garment-type" required>
                                        <option value="">Select Type</option>
                                        <option value="Shirt">Shirt</option>
                                        <option value="T-Shirt">T-Shirt</option>
                                        <option value="Pants">Pants</option>
                                        <option value="Jacket">Jacket</option>
                                        <option value="Dress">Dress</option>
                                        <option value="Skirt">Skirt</option>
                                        <option value="Suit">Suit</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="fabric-type">Fabric Type</label>
                                    <select id="fabric-type" required>
                                        <option value="">Select Fabric</option>
                                        <option value="Cotton">Cotton</option>
                                        <option value="Silk">Silk</option>
                                        <option value="Polyester">Polyester</option>
                                        <option value="Wool">Wool</option>
                                        <option value="Linen">Linen</option>
                                        <option value="Denim">Denim</option>
                                        <option value="Mixed">Mixed</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="assignment-quantity">Quantity</label>
                                    <input type="number" id="assignment-quantity" min="1" value="1" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="expected-date">Expected Completion Date</label>
                                    <input type="date" id="expected-date">
                                </div>
                                
                                <div class="form-group">
                                    <label for="assignment-notes">Notes</label>
                                    <textarea id="assignment-notes" rows="2" placeholder="Special instructions..."></textarea>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Assign Work</button>
                            </form>
                            
                            <h3>Work Assignments</h3>
                            <div class="filter-bar">
                                <input type="text" id="search-assignments" class="search-input" placeholder="Search assignments...">
                            </div>
                            <div id="assignments-list" class="table-container"></div>
                        </div>
                        
                        <!-- Fabrics Tab -->
                        <div id="fabrics-tab" class="tab-content">
                            <h3>Add Fabric Stock</h3>
                            <form id="fabric-form" class="form">
                                <div class="form-group">
                                    <label for="fabric-type-input">Fabric Type</label>
                                    <input type="text" id="fabric-type-input" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="fabric-color">Color</label>
                                    <input type="text" id="fabric-color">
                                </div>
                                
                                <div class="form-group">
                                    <label for="fabric-quantity">Quantity (meters)</label>
                                    <input type="number" id="fabric-quantity" step="0.01" min="0.01" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="fabric-location">Storage Location</label>
                                    <input type="text" id="fabric-location" placeholder="e.g., Rack A1">
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Add Fabric</button>
                            </form>
                            
                            <h3>Fabric Inventory</h3>
                            <div id="fabrics-list" class="table-container"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Section -->
                <div id="reports" class="section">
                    <div class="section-content">
                        <h2>Reports & Analytics</h2>
                        <div class="charts-row">
                            <div class="chart-card">
                                <div class="card-header">
                                    <h3>Monthly Trends</h3>
                                </div>
                                <div class="card-body">
                                    <canvas id="trendsChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- QR Code Scanner Library -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script>
        if (typeof Html5Qrcode === 'undefined') {
            console.error('Html5Qrcode library failed to load from primary CDN, trying fallback...');
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/html5-qrcode@2.3.8/html5-qrcode.min.js';
            document.body.appendChild(script);
        }
    </script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Core Scripts -->
    <script src="api-service.js"></script>
    <script src="config.js"></script>
    <script src="tailor.js"></script>
    <script src="app.js"></script>
    
    <!-- Dashboard Integration Script -->
    <script>
        // Override showSection to work with new layout
        const originalShowSection = window.showSection;
        window.showSection = function(sectionId, event) {
            if (event) event.preventDefault();
            
            // Update sidebar active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Find and activate the clicked nav item
            const clickedItem = event ? event.currentTarget : 
                document.querySelector(`.nav-item[onclick*="${sectionId}"]`);
            if (clickedItem) {
                clickedItem.classList.add('active');
            }
            
            // Update page title
            const pageTitle = document.querySelector('.page-title');
            const titles = {
                'dashboard': 'Dashboard',
                'create-product': 'Create Product',
                'scan-qr': 'Scan QR Code',
                'inventory': 'Inventory',
                'transactions': 'Transaction History',
                'tailor-management': 'Tailor Management',
                'reports': 'Reports & Analytics'
            };
            pageTitle.textContent = titles[sectionId] || 'Dashboard';
            
            // Call original function if it exists
            if (originalShowSection) {
                originalShowSection(sectionId, event);
            } else {
                // Hide all sections
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                    section.style.display = 'none';
                });
                
                // Show selected section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                    targetSection.style.display = 'block';
                }
            }
        };
        
        // Handle sidebar toggle
        document.getElementById('menu-toggle').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
        });
        
        // Initialize charts when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize sales chart
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                const gradient = salesCtx.getContext('2d').createLinearGradient(0, 0, 0, 300);
                gradient.addColorStop(0, 'rgba(99, 102, 241, 0.3)');
                gradient.addColorStop(1, 'rgba(99, 102, 241, 0.01)');
                
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        datasets: [{
                            label: 'Stock In',
                            data: [12, 19, 15, 25, 22, 30, 28],
                            borderColor: '#6366f1',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }, {
                            label: 'Stock Out',
                            data: [8, 12, 10, 18, 16, 22, 20],
                            borderColor: '#8b5cf6',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }
            
            // Initialize stock distribution chart
            const stockCtx = document.getElementById('stockChart');
            if (stockCtx) {
                new Chart(stockCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Shirts', 'Pants', 'Jackets', 'T-Shirts', 'Others'],
                        datasets: [{
                            data: [30, 25, 20, 15, 10],
                            backgroundColor: [
                                '#6366f1',
                                '#8b5cf6',
                                '#ec4899',
                                '#f59e0b',
                                '#10b981'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        },
                        cutout: '70%'
                    }
                });
            }
            
            // Mobile responsiveness
            if (window.innerWidth <= 768) {
                document.querySelector('.sidebar').classList.add('collapsed');
            }
        });
        
        // Export function placeholder
        function exportReport() {
            alert('Exporting report...');
        }
        
        // Sync function placeholder
        function syncData() {
            alert('Syncing data...');
        }
        
        // ============= TRANSACTION HISTORY FUNCTIONALITY =============
        
        // Transaction storage
        let allTransactions = [];
        let filteredTransactions = [];
        let currentTransactionFilter = 'all';
        
        // Initialize transaction system
        function initTransactionSystem() {
            loadTransactionData();
            setupTransactionListeners();
            updateTransactionDisplay();
        }
        
        // Load transactions from localStorage
        function loadTransactionData() {
            const stored = localStorage.getItem('transaction_history');
            if (stored) {
                allTransactions = JSON.parse(stored);
                // Ensure dates are Date objects
                allTransactions = allTransactions.map(t => ({
                    ...t,
                    timestamp: new Date(t.timestamp)
                }));
            } else {
                // Generate sample data if none exists
                generateSampleTransactions();
            }
            filteredTransactions = [...allTransactions];
        }
        
        // Generate sample transactions for demo
        function generateSampleTransactions() {
            const products = [
                { name: 'Blue Cotton Shirt', sku: 'BCS-M-001' },
                { name: 'Black Denim Jeans', sku: 'BDJ-L-002' },
                { name: 'Red Polo Shirt', sku: 'RPS-S-003' },
                { name: 'Gray Hoodie', sku: 'GH-XL-004' },
                { name: 'White T-Shirt', sku: 'WTS-M-005' }
            ];
            
            const users = ['John Doe', 'Jane Smith', 'Mike Johnson', 'Sarah Williams'];
            const types = ['stock-in', 'stock-out', 'update', 'remove'];
            
            allTransactions = [];
            
            // Generate 15 sample transactions
            for (let i = 0; i < 15; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const product = products[Math.floor(Math.random() * products.length)];
                const stockBefore = Math.floor(Math.random() * 150) + 50;
                const quantity = Math.floor(Math.random() * 30) + 1;
                
                let stockAfter = stockBefore;
                if (type === 'stock-in') {
                    stockAfter = stockBefore + quantity;
                } else if (type === 'stock-out' || type === 'remove') {
                    stockAfter = Math.max(0, stockBefore - quantity);
                }
                
                allTransactions.push({
                    id: `TRX-${String(i + 1).padStart(6, '0')}`,
                    type: type,
                    product: product,
                    quantity: quantity,
                    stockBefore: stockBefore,
                    stockAfter: stockAfter,
                    user: users[Math.floor(Math.random() * users.length)],
                    timestamp: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000)
                });
            }
            
            // Sort by newest first
            allTransactions.sort((a, b) => b.timestamp - a.timestamp);
            
            // Save to localStorage
            saveTransactions();
        }
        
        // Save transactions to localStorage
        function saveTransactions() {
            localStorage.setItem('transaction_history', JSON.stringify(allTransactions));
        }
        
        // Add new transaction
        function addTransaction(type, productData, quantity, user = 'Current User') {
            const transaction = {
                id: `TRX-${String(allTransactions.length + 1).padStart(6, '0')}`,
                type: type,
                product: {
                    name: productData.name,
                    sku: productData.sku
                },
                quantity: quantity,
                stockBefore: productData.currentStock || 0,
                stockAfter: calculateNewStock(type, productData.currentStock || 0, quantity),
                user: user,
                timestamp: new Date()
            };
            
            allTransactions.unshift(transaction);
            saveTransactions();
            updateTransactionDisplay();
            
            return transaction;
        }
        
        // Calculate new stock based on transaction type
        function calculateNewStock(type, currentStock, quantity) {
            switch(type) {
                case 'stock-in':
                    return currentStock + quantity;
                case 'stock-out':
                case 'remove':
                    return Math.max(0, currentStock - quantity);
                case 'update':
                    return currentStock;
                default:
                    return currentStock;
            }
        }
        
        // Filter transactions by type (dropdown version)
        function filterByTypeSelect(type) {
            currentTransactionFilter = type;
            
            // Apply filter
            if (type === 'all') {
                filteredTransactions = [...allTransactions];
            } else {
                // Map filter values to transaction types
                const typeMap = {
                    'in': 'stock-in',
                    'out': 'stock-out',
                    'update': 'update',
                    'remove': 'remove'
                };
                filteredTransactions = allTransactions.filter(t => t.type === typeMap[type]);
            }
            
            updateTransactionDisplay();
        }
        
        // Legacy filter function (kept for compatibility)
        function filterByType(type) {
            filterByTypeSelect(type);
        }
        
        // Search transactions
        function searchTransactions() {
            const searchTerm = document.getElementById('search-transactions')?.value.toLowerCase() || '';
            
            if (!searchTerm) {
                filteredTransactions = currentTransactionFilter === 'all' 
                    ? [...allTransactions]
                    : allTransactions.filter(t => t.type === currentTransactionFilter);
            } else {
                filteredTransactions = allTransactions.filter(t => 
                    t.id.toLowerCase().includes(searchTerm) ||
                    t.product.name.toLowerCase().includes(searchTerm) ||
                    t.product.sku.toLowerCase().includes(searchTerm) ||
                    t.user.toLowerCase().includes(searchTerm)
                );
                
                // Apply type filter if active
                if (currentTransactionFilter !== 'all') {
                    const typeMap = {
                        'in': 'stock-in',
                        'out': 'stock-out',
                        'update': 'update',
                        'remove': 'remove'
                    };
                    filteredTransactions = filteredTransactions.filter(t => 
                        t.type === typeMap[currentTransactionFilter]
                    );
                }
            }
            
            updateTransactionDisplay();
        }
        
        // Update transaction display
        function updateTransactionDisplay() {
            const tbody = document.getElementById('trans-tbody');
            if (!tbody) return;
            
            // Update record count
            const countElement = document.getElementById('transaction-count');
            if (countElement) {
                countElement.textContent = `${filteredTransactions.length} Records`;
            }
            
            // Get pagination settings
            const perPage = parseInt(document.getElementById('trans-per-page')?.value || '10');
            const displayTransactions = filteredTransactions.slice(0, perPage);
            
            if (displayTransactions.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 2rem; color: #9ca3af;">
                            No transactions found
                        </td>
                    </tr>`;
                return;
            }
            
            tbody.innerHTML = displayTransactions.map(createTransactionRow).join('');
        }
        
        // Create transaction row HTML
        function createTransactionRow(transaction) {
            const typeConfig = {
                'stock-in': { 
                    badge: 'stock-in', 
                    icon: 'arrow-down', 
                    text: 'Stock In', 
                    sign: '+',
                    color: 'positive'
                },
                'stock-out': { 
                    badge: 'stock-out', 
                    icon: 'arrow-up', 
                    text: 'Stock Out', 
                    sign: '-',
                    color: 'negative'
                },
                'update': { 
                    badge: 'updated', 
                    icon: 'edit', 
                    text: 'Updated', 
                    sign: '',
                    color: 'neutral'
                },
                'remove': { 
                    badge: 'removed', 
                    icon: 'trash', 
                    text: 'Removed', 
                    sign: '-',
                    color: 'negative'
                }
            };
            
            const config = typeConfig[transaction.type] || typeConfig['update'];
            const date = new Date(transaction.timestamp);
            const dateStr = date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
            const timeStr = date.toLocaleTimeString('en-US', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            return `
                <tr>
                    <td>${transaction.id}</td>
                    <td>
                        <div class="time-info">
                            <span class="date">${dateStr}</span>
                            <span class="time">${timeStr}</span>
                        </div>
                    </td>
                    <td>
                        <div class="product-info">
                            <span class="prod-name">${transaction.product.name}</span>
                            <span class="prod-sku">${transaction.product.sku}</span>
                        </div>
                    </td>
                    <td>
                        <span class="status-badge ${config.badge}">
                            <i class="fas fa-${config.icon}"></i> ${config.text}
                        </span>
                    </td>
                    <td class="qty-change ${config.color}">
                        ${config.sign}${transaction.quantity}
                    </td>
                    <td>
                        <span class="stock-before">${transaction.stockBefore}</span>
                        <i class="fas fa-arrow-right"></i>
                        <span class="stock-after">${transaction.stockAfter}</span>
                    </td>
                    <td>${transaction.user}</td>
                </tr>`;
        }
        
        // Export transactions to CSV
        function exportTransactions() {
            if (filteredTransactions.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            // Create CSV content
            const headers = ['Transaction ID', 'Date', 'Time', 'Product', 'SKU', 'Type', 'Quantity', 'Stock Before', 'Stock After', 'User'];
            const rows = filteredTransactions.map(t => {
                const date = new Date(t.timestamp);
                return [
                    t.id,
                    date.toLocaleDateString(),
                    date.toLocaleTimeString(),
                    t.product.name,
                    t.product.sku,
                    t.type.toUpperCase().replace('-', ' '),
                    t.quantity,
                    t.stockBefore,
                    t.stockAfter,
                    t.user
                ];
            });
            
            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `transactions-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            
            // Show success message
            alert('Transactions exported successfully!');
        }
        
        // Setup event listeners
        function setupTransactionListeners() {
            // Search input
            const searchInput = document.getElementById('search-transactions');
            if (searchInput) {
                searchInput.addEventListener('input', searchTransactions);
            }
        }
        
        // Initialize when the transactions section is shown
        document.addEventListener('DOMContentLoaded', function() {
            // Hook into the section display
            const originalShowSection = window.showSection;
            window.showSection = function(sectionId, event) {
                if (originalShowSection) {
                    originalShowSection(sectionId, event);
                }
                
                if (sectionId === 'transactions') {
                    initTransactionSystem();
                }
            };
        });
        
        // Public API for adding transactions from other parts of the app
        window.recordTransaction = function(type, productData, quantity, user) {
            return addTransaction(type, productData, quantity, user);
        };
    </script>
</body>
</html>